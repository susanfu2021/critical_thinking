
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Parallel Path</title>
    <style>
        body {
            font-family: 'Arial', 'Microsoft YaHei', sans-serif; /* Added Chinese font */
            background-color: #f0f0f0;
            color: #333;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            cursor: pointer; 
        }

        .book-container {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            padding: 2rem;
            width: 90%;
            max-width: 700px;
            text-align: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative; /* For the button */
        }
        
        #lang-toggle {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: #007bff;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em;
            z-index: 10;
        }

        #book-image {
            width: 100%;
            max-width: 400px;
            height: auto;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-bottom: 1.5rem;
        }

        #book-content {
            text-align: left;
            margin-top: 1rem;
            white-space: pre-wrap;
            line-height: 1.8;
            font-size: 1.1em;
            overflow-y: auto;
            max-height: 50vh;
            padding-right: 15px;
        }

        h1, h2, p {
            margin: 0.5rem 0;
        }

        #title, #author {
            color: #222;
        }
        
        #page-number {
            font-weight: bold;
            color: #666;
            margin-top: 1rem;
        }
    </style>
</head>
<body>
    <div class="book-container">
        <button id="lang-toggle">Change Language (EN)</button>
        <h1 id="title"></h1>
        <h2 id="author"></h2>
        <img id="book-image" src="" alt="Book Image">
        <p id="book-content"></p>
        <p id="page-number"></p>
    </div>

    <script>
        const ALL_BOOK_DATA = {
  "en": {
    "1": "Dr. Aris was a mathematician of great renown, but he was stuck. His problem was a knot of numbers and symbols, and his one, straight-line approach was failing him. He drew a single, determined line on his great blackboard, but it led nowhere.",
    "2": "Exhausted and frustrated, he slumped into his chair and fell into a deep sleep. But his mind, ever-active, began to wander. The rigid lines of his world softened and swirled into a strange, new landscape.",
    "3": "He awoke in a world of pure thought, a place where concepts had form. There, he saw a nimble figure named Pippa, who was not walking a single path, but bouncing joyfully between many. Each path was a different color, a different possibility.",
    "4": "\"Why follow one path,\" she chirped, \"when you can explore them all at once?\" She showed him how she could get from one point to another by traveling on a red path, a blue path, and a yellow path, all at the same time, without choosing just one.",
    "5": "Dr. Aris tried to follow her example, but his mind was trained for a single, straight line. He chose one path and tried to walk it, but it twisted and turned in ways he didn't expect, and he found himself stuck.",
    "6": "\"The solution isn't in one path,\" Pippa said, \"but in the way they all connect. Each path holds a piece of the answer, a different way of looking at the same problem.\"",
    "7": "Just then, a calm, wise figure named Caelus appeared. \"Pippa's paths are like different minds,\" he said. \"Each one sees the problem from a unique perspective. The true solution is found when they work together.\"",
    "8": "Caelus showed him how the different paths, when viewed together, formed a beautiful, complex pattern. The intersections were not dead ends, but moments of insight. The loops were not mistakes, but elegant solutions.",
    "9": "Dr. Aris understood. His linear approach was like trying to see a whole constellation by only looking at one star. The solution to his problem wasn't a single line, but the entire network of possibilities, all working in parallel.",
    "10": "He woke up, the morning sun streaming through his window. The blackboard was still there, but he no longer saw it as a place for a single line. He picked up his chalk and, with a new sense of purpose, began to draw not one path, but many, exploring the problem from every angle at once.",
    "title": "The Parallel Path",
    "author": "By AI"
  },
  "zh": {
    "1": "阿里斯博士是一位享有盛誉的数学家，但他遇到了瓶颈。他的问题是一个数字和符号的死结，而他单一的、直线型的方法正在让他功亏一篑。他在巨大的黑板上画了一条坚定的直线，但它毫无出路。",
    "2": "他筋疲力尽、心灰意冷地瘫倒在椅子上，陷入了沉睡。但他的思绪一如既往地活跃，开始漫游。他世界中僵硬的线条柔化并旋转成了一个奇特的、新的景象。",
    "3": "他在一个纯粹思想的世界中醒来，这是一个概念具有形态的地方。在那里，他看到了一个名叫皮帕的灵活身影，她没有走一条路，而是欢快地在许多条道路之间弹跳。每一条路径都是一种不同的颜色，一种不同的可能性。",
    "4": "“为什么要只走一条路，”她叽喳道，“当你能同时探索所有道路时？”她向他展示了她如何通过同时走红色的路、蓝色的路和黄色的路，而无需只选择一条，从一个点到达另一个点。",
    "5": "阿里斯博士试图效仿她的例子，但他的大脑只接受单一的直线。他选择了一条路，试图走下去，但它以他意想不到的方式扭曲和转弯，他发现自己陷入了困境。",
    "6": "皮帕说：“解决方案不在于一条路径，而在于它们如何全部连接。每条路径都持有答案的一个片段，一种看待同一个问题的不同方式。”",
    "7": "就在这时，一个名叫卡洛斯的沉静而睿智的身影出现了。“皮帕的路径就像不同的思想，”他说。“每一种思想都从独特的视角看待问题。当它们共同协作时，才能找到真正的解决方案。”",
    "8": "卡洛斯向他展示了不同的路径，当它们被一起看待时，形成了一个美丽而复杂的模式。交叉点不是死胡同，而是洞察的瞬间。回路不是错误，而是优雅的解决方案。",
    "9": "阿里斯博士明白了。他线性的方法就像试图只看一颗星来了解整个星座。他问题的解决方案不是一条单一的线，而是整个可能性网络，全部并行运作。",
    "10": "他醒来了，晨光透过窗户射进来。黑板仍然在那里，但他不再将其视为一个只容得下单条线的地方。他拿起粉笔，带着一种新的目的感，开始描绘的不是一条路径，而是许多条，同时从各个角度探索这个问题。",
    "title": "并行之路",
    "author": "作者： 人工智能"
  }
};
        
        const synth = window.speechSynthesis;
        let currentLang = 'en'; // Default language is English
        let currentPage = -1; // -1 for cover

        // Mapping language codes to speech voices (adjust these to specific voices if needed)
        const VOICE_MAP = {
            'en': 'en-US',
            'zh': 'zh-CN' 
        };
        
        function speakContent(text) {
            if (!synth) {
                console.warn("Speech synthesis not supported.");
                return;
            }
            
            if (synth.speaking) {
                synth.cancel();
            }

            const utterance = new SpeechSynthesisUtterance(text);
            
            // Set the language voice based on the current locale
            const voiceCode = VOICE_MAP[currentLang];
            const voices = synth.getVoices();
            const selectedVoice = voices.find(voice => voice.lang === voiceCode) || null;
            
            if (selectedVoice) {
                utterance.voice = selectedVoice;
            } else {
                // Fallback: set the language tag
                utterance.lang = voiceCode;
            }

            synth.speak(utterance);
        }
        
        function stopSpeaking() {
            if (synth && synth.speaking) {
                synth.cancel();
            }
        }

        function getBookData() {
            return ALL_BOOK_DATA[currentLang];
        }

        document.addEventListener('DOMContentLoaded', () => {
            const imageElement = document.getElementById('book-image');
            const contentElement = document.getElementById('book-content');
            const titleElement = document.getElementById('title');
            const authorElement = document.getElementById('author');
            const pageNumberElement = document.getElementById('page-number');
            const langToggleButton = document.getElementById('lang-toggle');

            // Function to toggle language
            function toggleLanguage() {
                currentLang = currentLang === 'en' ? 'zh' : 'en';
                langToggleButton.textContent = `Change Language (${currentLang.toUpperCase()})`;
                currentPage = -1; // Reset to cover page on language change
                updateUI();
            }
            
            langToggleButton.addEventListener('click', (event) => {
                event.stopPropagation(); // Prevent the click from triggering page navigation
                toggleLanguage();
            });

            function updateUI() {
                const bookData = getBookData();
                const bookKeys = Object.keys(bookData);
                const isCoverPage = currentPage === -1;
                const totalTextPages = bookKeys.filter(key => !isNaN(parseInt(key))).length;
                const isEndPage = currentPage === totalTextPages;

                let imagePath, content, title, author, pageText;

                // --- 1. Determine Content and Metadata ---
                if (isCoverPage) {
                    title = bookData.title || 'Untitled';
                    author = bookData.author || '';
                    imagePath = `images/${bookData.cover || 'cover.png'}`;
                    content = bookData.cover_text || '';
                    pageText = '';
                } else if (isEndPage) {
                    title = bookData.title;
                    author = bookData.author;
                    imagePath = `images/end.png`;
                    content = bookData.end || '';
                    pageText = currentLang === 'en' ? 'End Page' : '结束页';
                } else {
                    const pageKey = (currentPage + 1).toString();
                    title = '';
                    author = '';
                    imagePath = `images/${pageKey}.png`;
                    content = bookData[pageKey] || '';
                    pageText = `${currentLang === 'en' ? 'Page' : '页'} ${pageKey} ${currentLang === 'en' ? 'of' : '共'} ${totalTextPages}`;
                }
                
                // --- 2. Update DOM Elements ---
                titleElement.style.display = isCoverPage ? 'block' : 'none';
                authorElement.style.display = isCoverPage ? 'block' : 'none';

                titleElement.textContent = bookData.title;
                authorElement.textContent = bookData.author;
                imageElement.src = imagePath;
                contentElement.textContent = content;
                pageNumberElement.textContent = pageText;
                
                // --- 3. Speech Logic ---
                let speechText;
                if (isCoverPage) {
                    speechText = `${bookData.title}. By ${bookData.author}. ${content}`;
                } else {
                    speechText = content;
                }
                
                stopSpeaking();
                speakContent(speechText);
            }

            function changePage(direction) {
                const bookData = getBookData();
                const totalTextPages = Object.keys(bookData).filter(key => !isNaN(parseInt(key))).length;
                let newPage = currentPage + direction;

                // Looping Logic (End Page to Cover Page)
                if (direction === 1) { // Moving forward (Next)
                    if (newPage > totalTextPages) {
                        newPage = -1; // Loop back to the cover page
                    }
                } else if (direction === -1) { // Moving backward (Previous)
                    if (newPage < -1) {
                        return; // Stop at the cover page
                    }
                }
                
                if (newPage >= -1 && newPage <= totalTextPages) {
                    currentPage = newPage;
                    updateUI();
                }
            }

            // --- Navigation Event Handlers (Click and Keypress) ---
            document.body.addEventListener('click', (event) => {
                // Check if the click was on the language toggle button; if so, do nothing.
                if (event.target.id === 'lang-toggle') return;

                const isRightSide = event.clientX > window.innerWidth / 2;
                if (isRightSide) {
                    changePage(1);
                } else {
                    if (currentPage > -1) {
                        changePage(-1);
                    }
                }
            });

            document.body.addEventListener('keyup', (event) => {
                // Check for Enter key (keyCode 13 or key 'Enter')
                if (event.key === 'Enter' || event.keyCode === 13) {
                    changePage(1);
                } 
                else if (event.key === 'ArrowRight' || event.keyCode === 39) {
                    changePage(1);
                } else if (event.key === 'ArrowLeft' || event.keyCode === 37) {
                    if (currentPage > -1) {
                        changePage(-1);
                    }
                }
            });
            
            updateUI(); // Initial UI setup
        });
    </script>
</body>
</html>
